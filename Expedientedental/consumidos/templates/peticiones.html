{% extends 'dash.html' %}
{% load static from staticfiles %}

{% block content %}
<h2 class="page-header">{% block title %}Peticiones{% endblock %}</h2>

{% if paqueteconsumidos %}
<table class="table table-hover">

  <thead>

    <tr>

      <th>Servicio</th>
      <th>Medico</th>
      <th>Paciente</th>
      <th>Fecha</th>
      <th>Status</th>
      <th>&nbsp;</th>
      <th>&nbsp;</th>

    </tr>

  </thead>

  <tbody>

  <!-- TODO: Separate status surtidos and en espera into two groups somehow ((prolly pass it in the context separately)) -->

    {% for paquete in paqueteconsumidos %}
    <tr>

      <td class="padded">{{ paquete.servicio }}</td>
      <td class="padded">{{ paquete.medico }}</td>
      <td class="padded">{{ paquete.paciente }}</td>
      <td class="padded">{{ paquete.fecha }}</td>
      <td class="padded"><span class="label">{{ paquete.get_status_display }}</span></td>

      {% if paquete.status == 'en_espera' %}
      <td><a href="{% url consumidos:peticion_update paquete.id %}" class="btn btn-default">Atender</a></td>
      {% elif paquete.status == 'surtido' %}
      <td class="padded"><a href="{% url consumidos:paquete_recibo paquete.id %}"><i class="fa fa-print fa-fw"></i> Imprimir Acuse</a></td>
      {% else %}
      <td><a href="{% url consumidos:peticion_detail paquete.id %}" class="btn btn-default">Actualizar</a></td>
      {% endif %}


    </tr>
    {% endfor %}

  </tbody>

</table>
{% else %}
<p class="lead text-center text-muted">No hay peticiones.</p>
{% endif %}
{% endblock %}

{% block javascript %}
<script>
$(function() {

  $.each($('.label'), function(){
    var status = $(this);

    if(status.text() == 'En Espera') {

      status.addClass(' label-warning');

    } else if(status.text() == 'Surtido') {

      status.addClass(' label-primary');

    } else if(status.text() == 'Por Entregar') {

      status.addClass(' label-info');

    } else {

      status.addClass(' label-default');

    }

  })
})
</script>
{% endblock javascript %}
